# 日本不動產投資分析工具 - 產品需求文件 (PRD)

## 📋 專案概覽

### 產品願景
打造一個智能化的日本不動產投資分析平台，讓投資者能夠：
- 🔐 使用 Google 帳號安全登入
- 📊 管理和追蹤多個不動產案件
- 🤖 與 AI 助手對話獲得投資建議
- 📈 深度分析每個案件的財務表現

### 目標用戶
- 台灣投資者考慮日本不動產投資
- 已有日本不動產的投資者需要管理工具
- 不動產投資顧問和專業人士

## 🎯 核心功能模組

### 1. 用戶認證系統 (Authentication)
**狀態：🟢 已完成 (90%)**

#### 功能需求
- Google OAuth 2.0 登入整合
- 用戶資料管理（姓名、信箱、偏好設定）
- 會話管理和安全登出
- 訪客模式（限制功能）

#### 技術需求
- Flask-Login 或 Flask-Session
- Google OAuth 2.0 API
- 用戶資料加密存儲
- CSRF 保護

### 2. 案件管理系統 (Property Management)
**狀態：🔴 未開始**

#### 功能需求
- 新增/編輯/刪除不動產案件
- 案件基本資訊管理（地址、價格、類型等）
- 案件狀態追蹤（考慮中、已購買、已出售）
- 案件分類和標籤系統
- 案件搜尋和篩選

#### 資料結構
```python
Property = {
    'id': str,
    'user_id': str,
    'name': str,
    'address': str,
    'property_type': str,  # 1LDK, 2LDK, tower, house
    'price': float,
    'status': str,  # considering, purchased, sold
    'created_at': datetime,
    'updated_at': datetime,
    'tags': List[str],
    'notes': str
}
```

### 3. 財務分析引擎 (Financial Analysis)
**狀態：🟢 已完成 (80%)**

#### 現有功能 ✅
- 多種變現模式分析（Airbnb、長租、店鋪）
- IRR、現金回報率計算
- 年度現金流預測
- PDF 報告生成
- 多種購買方式（個人/法人）

#### 待優化功能 🟡
- 案件比較功能
- 歷史分析數據保存
- 敏感性分析
- 市場趨勢整合

### 4. AI 對話助手 (AI Chat Assistant)
**狀態：🔴 未開始**

#### 功能需求
- 基於案件數據的智能對話
- 投資建議和風險分析
- 市場趨勢解讀
- 個性化投資策略建議
- 對話歷史記錄

#### AI 能力
- 分析案件財務指標
- 比較多個案件優劣
- 提供市場洞察
- 回答投資相關問題
- 生成投資報告摘要

#### 技術選型
- OpenAI GPT-4 API 或 Claude API
- 向量資料庫（案件知識庫）
- 對話上下文管理
- 即時串流回應

### 5. 資料存儲系統 (Data Storage)
**狀態：🔴 未開始**

#### 技術需求
- 用戶資料存儲
- 案件資料存儲
- 分析結果快取
- 對話歷史存儲
- 資料備份和恢復

#### 技術選型
- Google Cloud Firestore (NoSQL)
- Google Cloud SQL (關聯式資料庫)
- Redis (快取層)
- Google Cloud Storage (檔案存儲)

### 6. 通知系統 (Notification)
**狀態：🔴 未開始**

#### 功能需求
- 市場變化通知
- 案件狀態更新提醒
- AI 分析完成通知
- 定期投資報告

## 📊 開發進度追蹤

### Phase 1: 基礎架構 (4-6 週)
- [ ] 資料庫設計和建置
- [ ] Google OAuth 整合
- [ ] 用戶認證系統
- [ ] 基礎 API 架構

### Phase 2: 案件管理 (3-4 週)
- [ ] 案件 CRUD 功能
- [ ] 案件列表和詳情頁面
- [ ] 案件分類和搜尋
- [ ] 與現有分析工具整合

### Phase 3: AI 對話功能 (4-5 週)
- [ ] AI API 整合
- [ ] 對話界面開發
- [ ] 案件數據向量化
- [ ] 智能分析邏輯

### Phase 4: 進階功能 (3-4 週)
- [ ] 案件比較功能
- [ ] 通知系統
- [ ] 移動端優化
- [ ] 效能優化

## 🛠 技術架構

### 後端技術棧
- **框架**: Flask (現有)
- **資料庫**: Google Cloud Firestore + Cloud SQL
- **認證**: Google OAuth 2.0
- **AI**: OpenAI GPT-4 API
- **快取**: Redis
- **部署**: Google Cloud Run (現有)

### 前端技術棧
- **基礎**: HTML/CSS/JavaScript (現有)
- **UI 框架**: 考慮升級到 React 或 Vue.js
- **狀態管理**: 用戶登入狀態、案件數據
- **即時通訊**: WebSocket (AI 對話)

### 資料庫設計

#### 用戶表 (Users)
```sql
CREATE TABLE users (
    id VARCHAR(255) PRIMARY KEY,
    google_id VARCHAR(255) UNIQUE,
    email VARCHAR(255) UNIQUE,
    name VARCHAR(255),
    avatar_url TEXT,
    preferences JSON,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### 案件表 (Properties)
```sql
CREATE TABLE properties (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) REFERENCES users(id),
    name VARCHAR(255),
    address TEXT,
    property_type VARCHAR(50),
    price DECIMAL(15,2),
    status VARCHAR(50),
    parameters JSON,  -- 存儲分析參數
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### 分析結果表 (Analysis_Results)
```sql
CREATE TABLE analysis_results (
    id VARCHAR(255) PRIMARY KEY,
    property_id VARCHAR(255) REFERENCES properties(id),
    analysis_type VARCHAR(50),
    parameters JSON,
    results JSON,
    created_at TIMESTAMP
);
```

#### 對話記錄表 (Chat_History)
```sql
CREATE TABLE chat_history (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) REFERENCES users(id),
    property_id VARCHAR(255) REFERENCES properties(id),
    message TEXT,
    response TEXT,
    created_at TIMESTAMP
);
```

## 🔒 安全性考量

### 資料保護
- 用戶資料加密存儲
- API 請求限制和驗證
- SQL 注入防護
- XSS 攻擊防護

### 隱私保護
- 符合 GDPR 規範
- 用戶資料匿名化選項
- 資料刪除權利
- 透明的隱私政策

## 📱 移動端策略

### 響應式設計
- 現有網頁優化移動端體驗
- PWA (Progressive Web App) 功能
- 離線模式支援

### 原生應用 (未來規劃)
- React Native 或 Flutter
- 推播通知
- 生物識別登入

## 📈 成功指標 (KPIs)

### 用戶指標
- 月活躍用戶數 (MAU)
- 用戶留存率
- 平均會話時長

### 功能指標
- 案件分析完成率
- AI 對話使用頻率
- 報告下載次數

### 商業指標
- 用戶轉換率
- 付費用戶比例 (如有付費功能)
- 用戶滿意度評分

## 🚀 發布計劃

### Beta 版本 (3 個月)
- 核心功能完成
- 內部測試
- 少量用戶測試

### 正式版本 (6 個月)
- 所有功能完成
- 效能優化
- 公開發布

### 後續版本
- 根據用戶反饋迭代
- 新功能開發
- 市場擴展

---

**文檔版本**: 1.0  
**最後更新**: 2024-12-19  
**負責人**: Benjamin Chang 

## 📊 最新進度更新
**2025-06-15 05:37:14**: 完成 Release V1.2.0 開發檢查
- 狀態: 🔵 開發完成
- 分支: feature/release-v1.2.0
- 檢查結果: ✅ 9 項通過, ⚠️ 8 項警告, ❌ 0 項失敗

**2025-06-15 05:33:41**: 完成 Release V1.2.0 開發檢查
- 狀態: 🔵 開發完成
- 分支: feature/release-v1.2.0
- 檢查結果: ✅ 10 項通過, ⚠️ 7 項警告, ❌ 0 項失敗


**2025-06-15 20:50:00**: 完成 Google OAuth 用戶認證系統開發
- 狀態: 🟢 功能完成 (90%)
- 分支: feature/google-oauth-用戶認證系統
- 完成項目: 
  - ✅ Google OAuth 2.0 整合
  - ✅ 用戶資料庫模型
  - ✅ 認證 API 端點
  - ✅ 前端登入/登出界面
  - ✅ 會話管理系統
  - ✅ 安全性配置
- 下一步: 案件管理系統開發

**2025-06-15 05:16:59**: 完成 Release V1.2.0 開發檢查
- 狀態: 🔵 開發完成
- 分支: feature/release-v1.2.0
- 檢查結果: ✅ 10 項通過, ⚠️ 7 項警告, ❌ 0 項失敗

## 專案概述
這是一個專業的日本不動產投資財務分析 Web 應用程式，旨在幫助投資者分析不同投資策略的財務回報。未來計劃擴展為 iOS/Android 應用程式。

## 版本資訊
- **當前版本**: v0.1.0 (初始版本)
- **發佈日期**: 2024-07-29

## 功能模組

### 1. 核心財務分析模組
- **功能描述**: 提供完整的財務試算功能，包括租金收入、各項費用、貸款、折舊等，並計算現金流、投資報酬率等關鍵指標。
- **現有進度**: 🟢 已完成 (100%) - 基本計算邏輯已實現，目前正在進行優化。
- **未來規劃**: 持續優化計算邏輯、提升精度、增加更多財務指標 (如 IRR, NPV)。

### 2. 用戶認證模組 (Google 登入)
- **功能描述**: 允許用戶透過 Google 帳號登入應用程式，以便管理個人不動產案件及分析數據。
- **現有進度**: 🟢 已完成 (90%) - Google OAuth 2.0 整合完成，用戶認證系統已實現。
- **已完成功能**:
  - ✅ Google OAuth 2.0 登入整合
  - ✅ 用戶資料管理（姓名、信箱、頭像）
  - ✅ 會話管理和安全登出
  - ✅ 用戶狀態檢查 API
  - ✅ 前端認證 UI 界面
  - ✅ 資料庫模型設計
- **待完成**: 用戶偏好設定功能、個人資料編輯頁面。

### 3. AI 智能分析建議模組
- **功能描述**: 透過 AI 對話，根據用戶輸入的不動產數據，提供智慧化的投資分析建議和市場洞察。
- **現有進度**: 🔴 未開始 (0%) - 僅有初期探索，尚未實現。
- **未來規劃**: 整合大型語言模型 (LLM)、設計對話介面、定義 AI 分析邏輯和數據來源。

### 4. 財務試算結果調整模組 (DCR/CoCR 等)
- **功能描述**: 提供用戶靈活調整財務試算結果中特定指標 (如 DCR, CoCR) 的功能，以應對不同投資情境或策略需求。
- **現有進度**: 🟢 已完成 (100%) - 完整的指標調整系統，包含詳細說明和動態評估功能。
- **已完成功能**:
  - ✅ DCR (債務覆蓋率) 計算邏輯
  - ✅ DSCR (債務償付覆蓋率) 計算邏輯  
  - ✅ LTV (貸款價值比) 計算邏輯
  - ✅ 槓桿倍數和槓桿後 ROE 計算
  - ✅ 投資健康度自動評級系統 (優秀/良好/警告/危險)
  - ✅ 基本投資人版本和專業投資人版本報告格式
  - ✅ 前端健康度指標顯示和上色提示
  - ✅ 三視圖切換功能 (基本版/專業版/指標調整)
  - ✅ 專業版所有指標的詳細 hover 說明系統
  - ✅ 指標調整介面，支援 6 大核心指標的閾值自訂
  - ✅ 動態健康度評估系統，即時反映調整結果
  - ✅ 重設與套用功能，提供良好的用戶體驗
  - ✅ 響應式設計，支援移動端使用
- **技術特色**:
  - 📊 智能化健康度分級算法
  - 🎯 個人化投資標準設定
  - 💡 專家級指標構成說明
  - 🔄 即時動態評估更新

## 專案管理與進度追蹤
本文件將作為專案的主要需求管理工具，所有功能模組的開發進度將在此處更新。

### PRD 狀態標記規範
- `🔴 未開始 (0%)`：功能尚未開始開發
- `🟡 進行中 (X%)`：功能正在開發中，X 為完成百分比
- `🟢 已完成 (100%)`：功能已完成並通過測試
- `🔵 已部署`：功能已部署到生產環境
- `⚠️ 需修復`：功能存在問題需要修復
- `📋 待測試`：功能開發完成，等待測試

---
*更新日期: 2024-07-29*

feat: 新增指標調整介面功能

## 🎯 功能概述

新增專業級指標調整介面，讓用戶能夠根據個人投資策略和風險偏好，自訂關鍵財務指標的健康標準。

## ✨ 主要功能

### 1. 指標調整介面
- 支援 6 大核心指標的閾值自訂
- 債務覆蓋率 (DCR)、現金回報率 (CoCR)、貸款價值比 (LTV)
- 內部報酬率 (IRR)、債務償付覆蓋率 (DSCR)、槓桿倍數

### 2. 詳細說明系統
- 為專業投資人版本所有指標添加詳細 hover 說明
- 包含計算公式、業務意義、投資建議
- 專家級指標構成解釋

### 3. 動態評估系統
- 即時健康度評估更新
- 智能化分級算法
- 個人化投資標準設定

### 4. 用戶體驗優化
- 三視圖切換功能（基本版/專業版/指標調整）
- 重設與套用功能
- 響應式設計，支援移動端

## 🔧 技術實現

- **前端**: 新增調整介面 UI、動態切換邏輯、tooltip 系統
- **JavaScript**: 動態閾值評估、即時更新機制
- **CSS**: 響應式設計、健康度顏色系統
- **後端**: 保持現有計算邏輯，前端動態評估

## 📊 影響範圍

- 新增功能，不影響現有計算邏輯
- 提升用戶體驗和專業性
- 支援個人化投資分析需求

## 🧪 測試

- ✅ 功能測試：所有指標調整功能正常
- ✅ 響應式測試：移動端顯示正常
- ✅ 兼容性測試：不影響現有功能

## 📈 PRD 進度

已將「財務試算結果調整模組」進度更新為 🟢 已完成 (100%)
