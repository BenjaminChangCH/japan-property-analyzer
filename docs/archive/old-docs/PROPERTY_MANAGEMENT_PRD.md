# 案件管理系統 PRD (Property Management System)

## 📋 產品概述

### 功能願景
打造一個完整的日本不動產案件管理系統，讓投資者能夠：
- 📝 **管理多個不動產案件**：新增、編輯、刪除案件
- 📊 **追蹤投資組合**：統一管理所有投資案件
- 🔍 **智能搜尋篩選**：快速找到目標案件
- 📈 **比較分析決策**：並排比較多個案件的投資回報
- 🏷️ **分類標籤管理**：靈活的案件分類系統
- 📱 **行動端友善**：響應式設計，隨時隨地管理

### 目標用戶
- **主要用戶**：已登入的 Google 帳戶用戶
- **使用場景**：管理多個日本不動產投資案件
- **核心需求**：組織、追蹤、比較不同的投資機會

## 🎯 核心功能模組

### 1. 案件列表管理 (Property List Management)
**優先級：🔴 高 | 狀態：🔴 未開始 (0%)**

#### 功能需求
- **案件概覽列表**：以卡片形式展示所有案件
- **狀態標識**：考慮中 🟡 / 已購買 🟢 / 已出售 🔴
- **快速操作**：編輯、刪除、複製案件
- **排序功能**：按創建時間、價格、狀態排序
- **分頁載入**：支援大量案件的分頁顯示

#### UI/UX 設計
```
┌─────────────────────────────────────────────────────────────┐
│ 📋 我的案件管理                                    [+ 新增案件] │
├─────────────────────────────────────────────────────────────┤
│ 🔍 [搜尋案件...] 📊 [狀態篩選 ▼] 🏷️ [標籤篩選 ▼] 📈 [排序 ▼] │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │
│ │ 🟡 考慮中        │ │ 🟢 已購買        │ │ 🔴 已出售        │ │
│ │ 澀谷區 1LDK      │ │ 新宿區 2LDK      │ │ 池袋區 塔樓      │ │
│ │ ¥4,500萬        │ │ ¥6,200萬        │ │ ¥8,800萬        │ │
│ │ 🏷️ 高收益 首購   │ │ 🏷️ 穩定收租     │ │ 🏷️ 已獲利      │ │
│ │ [📊分析][✏️編輯] │ │ [📊分析][✏️編輯] │ │ [📊分析][✏️編輯] │ │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 技術實現
- **前端**：動態卡片佈局，支援響應式設計
- **後端**：RESTful API 提供 CRUD 操作
- **資料庫**：使用現有 Property 模型

### 2. 案件詳情管理 (Property Detail Management)
**優先級：🔴 高 | 狀態：🔴 未開始 (0%)**

#### 功能需求
- **基本資訊編輯**：名稱、地址、類型、價格
- **狀態管理**：考慮中 → 已購買 → 已出售
- **參數設定**：財務分析參數的儲存和載入
- **標籤系統**：自定義標籤，支援多選
- **備註功能**：詳細筆記和想法記錄
- **歷史記錄**：修改歷史追蹤

#### 表單設計
```
┌─────────────────────────────────────────────────────────────┐
│ ✏️ 編輯案件：澀谷區 1LDK                        [💾儲存] [❌取消] │
├─────────────────────────────────────────────────────────────┤
│ 📝 基本資訊                                                  │
│ 案件名稱: [澀谷區 1LDK                                    ] │
│ 物件地址: [東京都澀谷區...                                ] │
│ 房產類型: [1LDK ▼]  狀態: [考慮中 ▼]  價格: [4500] 萬日圓  │
│                                                            │
│ 🏷️ 標籤管理                                                │
│ [高收益] [首購] [+ 新增標籤]                                │
│                                                            │
│ 📊 財務參數 (可選)                                          │
│ [📋 載入上次分析參數] [🔄 重新分析]                          │
│                                                            │
│ 📝 備註                                                    │
│ [這個物件位於澀谷站步行5分鐘，周邊商業設施完善...]           │
└─────────────────────────────────────────────────────────────┘
```

#### 技術實現
- **表單驗證**：前端即時驗證 + 後端數據驗證
- **自動儲存**：定期自動儲存草稿
- **參數整合**：與現有財務分析系統整合

### 3. 案件比較分析 (Property Comparison)
**優先級：🟡 中 | 狀態：🔴 未開始 (0%)**

#### 功能需求
- **多案件選擇**：支援 2-4 個案件同時比較
- **並排展示**：關鍵指標並排對比
- **視覺化比較**：圖表形式展示差異
- **匯出功能**：比較結果匯出為 PDF
- **決策建議**：基於比較結果的 AI 建議

#### 比較界面設計
```
┌─────────────────────────────────────────────────────────────┐
│ 📊 案件比較分析                                [📥匯出PDF] │
├─────────────────────────────────────────────────────────────┤
│ 選擇比較案件: [澀谷區1LDK ✓] [新宿區2LDK ✓] [+ 新增比較]     │
├─────────────────────────────────────────────────────────────┤
│              │ 澀谷區 1LDK    │ 新宿區 2LDK    │ 差異分析    │
│ 投資金額      │ ¥4,500萬      │ ¥6,200萬      │ +¥1,700萬  │
│ 年化回報率    │ 8.5%          │ 7.2%          │ -1.3%      │
│ 現金回報率    │ 4.2%          │ 3.8%          │ -0.4%      │
│ IRR          │ 12.3%         │ 10.1%         │ -2.2%      │
│ 投資建議      │ 🟢 推薦       │ 🟡 可考慮      │ 澀谷更優   │
└─────────────────────────────────────────────────────────────┘
```

#### 技術實現
- **比較算法**：多維度指標比較邏輯
- **圖表庫**：Chart.js 或 D3.js 視覺化
- **PDF 生成**：整合現有 PDF 報告系統

### 4. 搜尋與篩選系統 (Search & Filter)
**優先級：🟡 中 | 狀態：🔴 未開始 (0%)**

#### 功能需求
- **關鍵字搜尋**：案件名稱、地址、備註全文搜尋
- **狀態篩選**：按案件狀態篩選
- **價格範圍**：設定價格區間篩選
- **標籤篩選**：多標籤組合篩選
- **時間篩選**：按創建/更新時間篩選
- **儲存篩選**：常用篩選條件儲存

#### 篩選界面
```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 搜尋篩選                                    [🔄重置] [💾儲存] │
├─────────────────────────────────────────────────────────────┤
│ 關鍵字: [澀谷                                             ] │
│ 狀態: [全部 ▼] 類型: [全部 ▼] 價格: [1000] - [8000] 萬日圓  │
│ 標籤: [高收益 ✓] [首購 ✓] [穩定收租 ✗]                      │
│ 時間: [最近30天 ▼]                                          │
│ 結果: 找到 3 個符合條件的案件                                │
└─────────────────────────────────────────────────────────────┘
```

#### 技術實現
- **搜尋引擎**：SQLite FTS 或 Elasticsearch
- **即時篩選**：前端即時更新結果
- **URL 狀態**：篩選條件反映在 URL 中

### 5. 標籤管理系統 (Tag Management)
**優先級：🟢 低 | 狀態：🔴 未開始 (0%)**

#### 功能需求
- **標籤創建**：用戶自定義標籤
- **標籤分類**：預設標籤 + 自定義標籤
- **顏色管理**：標籤顏色自定義
- **標籤統計**：顯示每個標籤的使用次數
- **批量操作**：批量添加/移除標籤

#### 預設標籤建議
```
💰 投資類型: 高收益、穩定收租、資本增值、首購
🏠 物件特色: 新築、築淺、車站近、商圈佳
📊 分析狀態: 已分析、待分析、需更新
🎯 投資階段: 考慮中、談判中、已簽約、已交屋
⚠️ 風險標記: 高風險、需注意、待確認
```

## 🔄 用戶流程設計

### 新用戶首次使用流程
1. **Google 登入** → 2. **歡迎引導** → 3. **新增第一個案件** → 4. **執行財務分析** → 5. **儲存案件**

### 日常使用流程
1. **查看案件列表** → 2. **篩選/搜尋目標案件** → 3. **查看詳情/編輯** → 4. **執行分析** → 5. **比較案件** → 6. **做出決策**

### 案件管理流程
1. **新增案件** → 2. **設定基本資訊** → 3. **執行財務分析** → 4. **儲存參數** → 5. **更新狀態** → 6. **追蹤進度**

## 🛠️ 技術實現規劃

### Phase 1: 基礎 CRUD 功能 (2-3 週)
- [ ] **案件列表頁面**：顯示所有案件的卡片式列表
- [ ] **新增案件功能**：基本資訊輸入表單
- [ ] **編輯案件功能**：修改案件資訊
- [ ] **刪除案件功能**：安全刪除確認
- [ ] **狀態管理**：案件狀態切換
- [ ] **基礎 API 端點**：GET/POST/PUT/DELETE /api/properties

### Phase 2: 進階功能 (2-3 週)
- [ ] **搜尋功能**：關鍵字搜尋
- [ ] **篩選功能**：多條件篩選
- [ ] **標籤系統**：標籤管理和應用
- [ ] **排序功能**：多種排序方式
- [ ] **分頁功能**：大量數據處理

### Phase 3: 分析整合 (2-3 週)
- [ ] **分析參數儲存**：將財務分析參數與案件關聯
- [ ] **快速分析**：從案件直接跳轉到分析
- [ ] **歷史分析**：查看案件的分析歷史
- [ ] **分析結果比較**：多案件分析結果對比

### Phase 4: 優化與擴展 (1-2 週)
- [ ] **響應式優化**：移動端體驗優化
- [ ] **效能優化**：大量數據載入優化
- [ ] **用戶體驗優化**：交互細節完善
- [ ] **測試與部署**：完整測試和生產部署

## 📊 API 設計規範

### RESTful API 端點
```python
# 案件管理 API
GET    /api/properties           # 獲取案件列表
POST   /api/properties           # 新增案件
GET    /api/properties/{id}      # 獲取單個案件
PUT    /api/properties/{id}      # 更新案件
DELETE /api/properties/{id}      # 刪除案件

# 搜尋與篩選 API
GET    /api/properties/search    # 搜尋案件
GET    /api/properties/filter    # 篩選案件

# 標籤管理 API
GET    /api/tags                 # 獲取所有標籤
POST   /api/tags                 # 新增標籤
PUT    /api/tags/{id}            # 更新標籤
DELETE /api/tags/{id}            # 刪除標籤

# 分析整合 API
POST   /api/properties/{id}/analyze    # 執行分析
GET    /api/properties/{id}/analyses   # 獲取分析歷史
POST   /api/properties/compare         # 比較分析
```

### 資料格式範例
```json
{
  "id": "prop_001",
  "name": "澀谷區 1LDK 投資案",
  "address": "東京都澀谷區神南1-1-1",
  "property_type": "1LDK",
  "price": 45000000,
  "status": "considering",
  "tags": ["高收益", "首購", "車站近"],
  "parameters": {
    "purchase_type": "individual",
    "monetization_model": "airbnb",
    "down_payment_ratio": 20,
    "loan_interest_rate": 1.5
  },
  "notes": "澀谷站步行5分鐘，周邊商業設施完善",
  "created_at": "2025-07-01T10:00:00Z",
  "updated_at": "2025-07-01T15:30:00Z"
}
```

## 🎨 UI/UX 設計規範

### 設計系統整合
- **遵循現有設計系統**：使用 `docs/DESIGN_SYSTEM.md` 中定義的規範
- **色彩方案**：
  - 考慮中：`var(--warning-color)` 🟡
  - 已購買：`var(--success-color)` 🟢
  - 已出售：`var(--error-color)` 🔴
- **字體系統**：使用定義的字體大小和字重變數
- **間距系統**：使用 `var(--spacing-*)` 變數
- **圓角陰影**：使用 `var(--radius-*)` 和 `var(--shadow-*)` 變數

### 響應式設計
- **桌面端**：3-4 欄卡片佈局
- **平板端**：2-3 欄卡片佈局
- **手機端**：1 欄卡片佈局，優化觸控操作

### 交互設計
- **載入狀態**：骨架屏 + 載入指示器
- **錯誤處理**：友善的錯誤提示
- **成功反饋**：操作成功的即時反饋
- **確認對話**：重要操作的二次確認

## 🧪 測試策略

### 單元測試
- [ ] **資料模型測試**：Property 模型的 CRUD 操作
- [ ] **API 端點測試**：所有 API 的功能測試
- [ ] **業務邏輯測試**：搜尋、篩選、比較邏輯

### 整合測試
- [ ] **用戶流程測試**：完整的案件管理流程
- [ ] **分析整合測試**：案件與財務分析的整合
- [ ] **權限測試**：用戶只能管理自己的案件

### 用戶驗收測試
- [ ] **可用性測試**：真實用戶的使用體驗
- [ ] **效能測試**：大量數據下的系統表現
- [ ] **相容性測試**：不同瀏覽器和裝置的相容性

## 📈 成功指標 (KPIs)

### 功能使用指標
- **案件新增率**：每月新增案件數量
- **案件管理活躍度**：編輯、更新案件的頻率
- **分析執行率**：案件分析功能的使用率
- **比較功能使用率**：多案件比較的使用頻率

### 用戶體驗指標
- **功能完成率**：用戶成功完成案件管理任務的比例
- **用戶滿意度**：案件管理功能的滿意度評分
- **頁面載入速度**：案件列表頁面的載入時間
- **錯誤率**：案件操作的錯誤發生率

## 🚀 部署與發布計劃

### 開發環境測試
- **本機測試**：完整功能開發和測試
- **STG 環境**：整合測試和用戶驗收測試
- **PRD 環境**：生產環境部署

### 發布策略
- **功能標誌**：使用 feature flag 控制功能發布
- **灰度發布**：逐步向用戶開放新功能
- **回滾計劃**：出現問題時的快速回滾方案

## 🔒 安全性與隱私

### 資料安全
- **用戶隔離**：確保用戶只能存取自己的案件
- **資料加密**：敏感資料的加密存儲
- **API 安全**：請求驗證和速率限制

### 隱私保護
- **資料最小化**：只收集必要的資料
- **用戶控制**：用戶可以刪除自己的所有資料
- **透明度**：清楚說明資料的使用方式

## 📝 後續規劃

### 短期優化 (1-2 個月)
- **效能優化**：大量案件的載入優化
- **用戶體驗優化**：根據用戶反饋改進界面
- **功能完善**：補充遺漏的小功能

### 中期擴展 (3-6 個月)
- **AI 整合**：案件管理的 AI 助手功能
- **高級分析**：更深度的案件分析功能
- **團隊協作**：多用戶協作管理案件

### 長期願景 (6-12 個月)
- **移動端 App**：原生移動應用開發
- **市場數據整合**：即時市場數據和趨勢分析
- **投資組合管理**：完整的投資組合管理功能

---

**文檔版本**: 1.0  
**創建日期**: 2025-07-01  
**負責人**: Benjamin Chang  
**狀態**: 🔴 待開發

## 📋 開發檢查清單

### 準備階段
- [ ] 確認現有資料庫模型 (✅ 已完成)
- [ ] 設計 API 規範
- [ ] 準備 UI/UX 設計稿
- [ ] 建立開發分支

### 開發階段
- [ ] 實現基礎 CRUD API
- [ ] 開發前端案件列表頁面
- [ ] 實現案件詳情頁面
- [ ] 新增搜尋篩選功能
- [ ] 整合財務分析系統

### 測試階段
- [ ] 單元測試
- [ ] 整合測試
- [ ] 用戶驗收測試
- [ ] 效能測試

### 部署階段
- [ ] STG 環境部署
- [ ] PRD 環境部署
- [ ] 監控和日誌設置
- [ ] 用戶培訓文檔 